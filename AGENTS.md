# Agent Guide: electron-apps

## Purpose
This repo hosts a set of lightweight Electron wrappers for popular web apps (ChatGPT, Gmail, etc.). Each app is a small Electron entrypoint that loads a URL and shares common window/tray behavior from `common/`.

## Key Commands
- Package all apps: `pnpm package`
  - Runs `pnpm -r --parallel run package` in each workspace.
  - Then runs `node scripts/postpackage-all.js` to create Linux `.desktop` entries.
- Package a single app (from its folder):
  - `pnpm run prepackage` (rollup bundle)
  - `pnpm run package` (electron-packager)

## Project Layout
- `common/`: Shared Electron behaviors (window creation, tray, badge, context menu, search, external links).
- `ChatGPT/`, `Discord/`, `GCP/`, `Gitlab/`, `Gmail/`, `Linear/`, `Notion/`, `Telegram/`, `Whatsup/`: individual apps.
- `rollup.config.js`: Shared rollup config; bundles each app's `index.ts` -> `bundle.js`.
- `scripts/postpackage-all.js`: Runs `postpackage.js` for each app folder.
- `postpackage.js`: Writes a Linux `.desktop` entry into `~/.local/share/applications/`.
- `pnpm-workspace.yaml`: Workspace definitions.

## App Structure (per folder)
- `index.ts`: App entrypoint. Typically calls `commonAppLifecycle(url, ...)`.
- `package.json`: Electron packaging scripts. `main` points to `bundle.js`.
- App icon: `AppName.svg` or `AppName.png`.
- Packaged output: `appname-electron-linux-x64/` (generated by electron-packager).

## Common Behavior Summary
- `common/createWindow.ts`:
  - Creates `BrowserWindow` with safe defaults.
  - Injects middle-click handler to open a new window.
  - Adds zoom hotkeys (Ctrl/Cmd + or -).
  - Custom context menu and external link handling.
- `common/index.ts`:
  - Enforces single-instance lock.
  - Supports system tray with optional badge rendering.
  - Supports custom user agent.
  - Reads optional env var `CHROMIUM_USER_DATA_PATH` to override the Electron user data directory.

## Adding a New App
1. Create a new folder (e.g. `MyApp/`).
2. Add `index.ts` similar to existing apps and point to the target URL.
3. Add `package.json` (copy from another app and adjust name/icon).
4. Add an icon file `MyApp.svg` or `MyApp.png`.
5. Add the folder to `pnpm-workspace.yaml`.

## Implementation Notes for Agents
- Keep changes in `common/` compatible with all apps; test at least one app before assuming behavior.
- `pnpm package` writes `.desktop` files outside the repo (Linux). Be careful running it in CI or restricted environments.
- Packaged folders may exist in the repo; avoid editing generated binaries unless explicitly asked.
- No tests are defined; validate behavior manually when changing Electron or window lifecycle logic.

## Environment
- Primary target: Linux x64 (electron-packager is configured for `--platform=linux --arch=x64`).
- Tooling: pnpm workspaces, Rollup, TypeScript, Electron.
